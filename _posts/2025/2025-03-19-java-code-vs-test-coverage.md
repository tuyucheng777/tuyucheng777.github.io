---
layout: post
title:  代码覆盖率与测试覆盖率
category: coverage
copyright: coverage
excerpt: JaCoCo
---

## 1. 概述

[软件测试](https://www.baeldung.com/cs/stlc-overview)可帮助我们确保代码正常运行，这使其成为开发过程的重要组成部分。在讨论测试时，可能会出现诸如[代码覆盖率](https://www.baeldung.com/cs/code-coverage)和测试覆盖率之类的术语。虽然它们都代表了衡量代码库有效性的一种方式，但它们指的是不同的概念。因此，我们不应该互换使用它们。

在本教程中，我们将了解代码和测试覆盖率之间的区别并讨论各自的含义。

## 2. 代码覆盖率

**代码覆盖率是一种测量测试中覆盖的源代码部分的机制**，它代表[白盒测试](https://www.baeldung.com/cs/testing-white-box-vs-black-box#white-box-testing)的一种形式，需要访问源代码并考虑实现细节和代码的内部结构。代码覆盖率主要由开发人员在[单元测试](https://www.baeldung.com/java-unit-testing-best-practices)中完成。

有几种方法可以测量代码覆盖率：

- 语句/行覆盖率检查测试期间至少执行一次的语句数。
- 分支覆盖率计算决策过程中覆盖分支的百分比。
- 条件/表达式覆盖确保每个条件至少被评估为真或假一次。
- 函数覆盖率计算至少被调用一次的方法数。

**代码覆盖率结果通常以百分比表示**，衡量测试覆盖的源代码的比例。

此外，我们通常需要一个外部工具来测量代码覆盖率。对于基于Java的应用程序，我们可以使用[JaCoCo](https://www.baeldung.com/jacoco)或[Cobertura](https://www.baeldung.com/cobertura)等工具。这些工具可以帮助我们生成详细的报告，显示源代码的哪些部分被覆盖，哪些部分没有被覆盖。

最常见的代码覆盖率类型是语句覆盖率，我们可以使用一般公式来计算：

```text
Statement coverage = (Number of executed statements / Total number of statements) * 100
```

类似地，我们可以计算其他代码覆盖率类型。

### 2.1 代码覆盖率优势

接下来，让我们来看看代码覆盖率的优势。首先，它提供了定量指标的结果。

使用代码覆盖率工具，**我们可以识别出测试未覆盖的源代码部分**。

此外，**我们可以更轻松地检测未使用的源代码**，从而使我们能够删除不必要的代码。

### 2.2 代码覆盖率的缺点

最后，我们来讨论一些代码覆盖率的缺点。

如上所述，代码覆盖率仅计算整个自动化测试过程中执行的源代码量，**它不能保证我们的测试有效且正确**。

我们可能在实现高代码覆盖率的同时编写糟糕的测试，考虑到这一点，100%的代码覆盖率并不一定意味着我们的代码没有错误和问题。此外，**强制100%的覆盖率可能会导致编写无用的测试只是为了提高代码覆盖率**。

## 3. 测试覆盖率

另一方面，**测试覆盖率是我们用来描述测试对应用程序功能的覆盖程度的指标**。

测试覆盖率的主要目标是确定应用程序的测试效果，同时考虑用例、需求、功能、风险、不同环境和其他因素。通过这样的覆盖率，我们可以覆盖所有必要的功能、业务需求和边缘情况。

**测试覆盖率是由QA团队从最终用户的角度计算得出的**，它有助于确定应用程序的哪些部分已经过测试，哪些部分可能仍需要我们关注。虽然它可能考虑了单元测试，但它还涵盖了其他方面，包括[功能测试](https://www.baeldung.com/java-functional-vs-non-functional-testing)、[集成测试](https://www.baeldung.com/integration-testing-in-spring)和验收测试。

此外，测试覆盖率与自动测试和手动测试都相关。我们可以使用[Selenium](https://www.baeldung.com/selenium-webdriver-page-object)、[Playwright](https://playwright.dev/)或[Cypress](https://www.cypress.io/)等工具进行自动测试，这些工具可以帮助我们比手动测试更轻松地计算测试覆盖率。

与代码覆盖率不同，测试覆盖率的重点是确保我们涵盖了应用程序的功能。

定义测试覆盖率有多种方法：

- 产品覆盖率检查测试是否涵盖了整体产品功能。
- 风险覆盖率检查测试对应用程序的脆弱部分(例如安全性)的覆盖程度。
- 需求覆盖率确保测试涵盖所有需求和用例。
- 兼容性覆盖率衡量应用程序在不同平台、浏览器和操作系统上的运行情况。
- 边界值覆盖检查测试覆盖边缘情况的效率。

与代码覆盖率不同，测试覆盖率是[定性](https://www.baeldung.com/cs/research-qualitative-quantitative)的而非定量的，因此量化起来更具挑战性。但是，如果我们想以计算需求覆盖率为例，我们可以使用以下公式：

```text
Requirements coverage = (Number of covered requirements / Total number of requirements) * 100
```

请注意，该表达式与代码覆盖率测量类似，但测试覆盖率计算的输入可能更难量化。

### 3.1 测试覆盖率优势

让我们看看测试覆盖率的一些积极方面。

首先，它确保应用程序的每个方面都经过检查，并确定仍需测试的功能。

与代码覆盖率不同，**它不一定需要技术知识**，尤其是在我们谈论手动测试时。因此，它更容易实现。

它代表一种[黑盒测试](https://www.baeldung.com/cs/testing-white-box-vs-black-box#black-box-testing)方法，测试人员无法访问源代码。它仅关注从给定输入中检索到的输出。

此外，**此类测试注重整体用户体验**。

### 3.2 测试覆盖率的缺点

就像代码覆盖率一样，测试覆盖率并不能保证应用程序能够顺利运行。

由于我们无法深入了解源代码，因此**我们无法衡量某些方面，例如代码库质量**。

此外，我们无法通过测试覆盖率检测源代码中未使用的部分。

## 4. 代码覆盖率与测试覆盖率的比较

总结一下，我们通过一个对比表来展示一下代码和测试覆盖率的区别：

|        代码覆盖率        |        测试覆盖率        |
|:-------------------:|:-------------------:|
|   衡量测试覆盖的源代码的百分比    |   通过测试来衡量覆盖的需求数量    |
|        定量测量         |       定量或定性测量       |
|     确保测试覆盖所有源代码     |   确保测试涵盖所有应用程序的功能   |
|       由开发人员完成       |        由QA完成        |
|       白盒测试方法        |       黑盒测试方法        |
|     通常在单元测试中完成      |     通常在验收测试中完成      |

## 5. 总结

在本文中，我们了解了软件开发中代码覆盖率和测试覆盖率的区别。

总而言之，代码和测试覆盖率之间的混淆是因为它们在某种程度上重叠。然而，它们并不完全相同。代码覆盖率关注通过自动化测试执行的代码量，我们通常使用在测试执行期间直接分析代码库的工具来计算它。另一方面，测试覆盖率衡量测试对应用程序功能、用户需求和潜在风险的覆盖程度。